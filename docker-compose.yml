services:
  strava-agent:
    build: .
    container_name: strava-agent
    ports:
      - "8000:8000"
    env_file:
      - .env
    # This allows the container to talk to Ollama running on the host machine
    extra_hosts:
      - "host.docker.internal:host-gateway"
    environment:
      # Override OLLAMA_HOST if needed, or rely on code defaults.
      # If your code uses localhost:11434, inside Docker that means the container itself.
      # We map host.docker.internal to reach the host.
      - OLLAMA_HOST=http://host.docker.internal:11434
      - DUCKDB_PATH=/app/data/interactions.duckdb
    volumes:
      - ./.env:/app/.env  # Mount .env to persist token updates if the app writes to it
      - ${STRAVA_DATA_DIR:-./data}:/app/data